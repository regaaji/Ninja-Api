function cov_20t5nwprvx(){var path="/home/programmer/git/Ninja-Api/src/controllers/auth.js";var hash="c734d8a9730aea9b8aaf42fcf2c92f8a84166da9";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/programmer/git/Ninja-Api/src/controllers/auth.js",statementMap:{"0":{start:{line:1,column:19},end:{line:1,column:44}},"1":{start:{line:2,column:15},end:{line:2,column:42}},"2":{start:{line:3,column:12},end:{line:3,column:35}},"3":{start:{line:4,column:50},end:{line:4,column:70}},"4":{start:{line:7,column:22},end:{line:7,column:24}},"5":{start:{line:9,column:0},end:{line:145,column:1}},"6":{start:{line:11,column:8},end:{line:32,column:9}},"7":{start:{line:12,column:25},end:{line:12,column:48}},"8":{start:{line:13,column:33},end:{line:13,column:80}},"9":{start:{line:14,column:28},end:{line:14,column:38}},"10":{start:{line:15,column:25},end:{line:23,column:13}},"11":{start:{line:24,column:27},end:{line:24,column:60}},"12":{start:{line:26,column:12},end:{line:26,column:34}},"13":{start:{line:28,column:12},end:{line:28,column:57}},"14":{start:{line:30,column:12},end:{line:30,column:30}},"15":{start:{line:31,column:12},end:{line:31,column:56}},"16":{start:{line:35,column:8},end:{line:77,column:9}},"17":{start:{line:36,column:10},end:{line:36,column:45}},"18":{start:{line:37,column:10},end:{line:37,column:45}},"19":{start:{line:38,column:25},end:{line:41,column:13}},"20":{start:{line:42,column:30},end:{line:42,column:43}},"21":{start:{line:43,column:27},end:{line:43,column:67}},"22":{start:{line:45,column:34},end:{line:45,column:83}},"23":{start:{line:48,column:13},end:{line:71,column:15}},"24":{start:{line:49,column:30},end:{line:49,column:111}},"25":{start:{line:50,column:37},end:{line:50,column:106}},"26":{start:{line:52,column:16},end:{line:52,column:49}},"27":{start:{line:54,column:14},end:{line:54,column:35}},"28":{start:{line:55,column:14},end:{line:55,column:39}},"29":{start:{line:56,column:14},end:{line:56,column:41}},"30":{start:{line:57,column:14},end:{line:57,column:41}},"31":{start:{line:59,column:14},end:{line:59,column:37}},"32":{start:{line:62,column:14},end:{line:65,column:16}},"33":{start:{line:68,column:18},end:{line:70,column:18}},"34":{start:{line:76,column:12},end:{line:76,column:65}},"35":{start:{line:81,column:8},end:{line:114,column:7}},"36":{start:{line:83,column:37},end:{line:83,column:63}},"37":{start:{line:84,column:26},end:{line:84,column:45}},"38":{start:{line:85,column:32},end:{line:85,column:44}},"39":{start:{line:86,column:9},end:{line:86,column:31}},"40":{start:{line:88,column:10},end:{line:90,column:10}},"41":{start:{line:89,column:11},end:{line:89,column:66}},"42":{start:{line:93,column:9},end:{line:95,column:9}},"43":{start:{line:94,column:10},end:{line:94,column:60}},"44":{start:{line:97,column:8},end:{line:109,column:10}},"45":{start:{line:98,column:10},end:{line:100,column:11}},"46":{start:{line:99,column:12},end:{line:99,column:43}},"47":{start:{line:104,column:26},end:{line:104,column:95}},"48":{start:{line:106,column:12},end:{line:108,column:14}},"49":{start:{line:112,column:11},end:{line:112,column:29}},"50":{start:{line:113,column:12},end:{line:113,column:73}},"51":{start:{line:119,column:8},end:{line:126,column:9}},"52":{start:{line:120,column:27},end:{line:120,column:54}},"53":{start:{line:122,column:12},end:{line:122,column:57}},"54":{start:{line:124,column:12},end:{line:124,column:56}},"55":{start:{line:131,column:8},end:{line:139,column:9}},"56":{start:{line:133,column:23},end:{line:133,column:40}},"57":{start:{line:134,column:27},end:{line:134,column:58}},"58":{start:{line:136,column:12},end:{line:136,column:57}},"59":{start:{line:138,column:12},end:{line:138,column:56}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:16},end:{line:10,column:17}},loc:{start:{line:10,column:44},end:{line:33,column:5}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:34,column:15},end:{line:34,column:16}},loc:{start:{line:34,column:43},end:{line:78,column:5}},line:34},"2":{name:"(anonymous_2)",decl:{start:{line:80,column:11},end:{line:80,column:12}},loc:{start:{line:80,column:39},end:{line:116,column:5}},line:80},"3":{name:"(anonymous_3)",decl:{start:{line:97,column:50},end:{line:97,column:51}},loc:{start:{line:97,column:69},end:{line:109,column:9}},line:97},"4":{name:"(anonymous_4)",decl:{start:{line:118,column:14},end:{line:118,column:15}},loc:{start:{line:118,column:49},end:{line:127,column:5}},line:118},"5":{name:"(anonymous_5)",decl:{start:{line:129,column:16},end:{line:129,column:17}},loc:{start:{line:129,column:51},end:{line:142,column:5}},line:129}},branchMap:{"0":{loc:{start:{line:48,column:13},end:{line:71,column:15}},type:"if",locations:[{start:{line:48,column:13},end:{line:71,column:15}},{start:{line:48,column:13},end:{line:71,column:15}}],line:48},"1":{loc:{start:{line:88,column:10},end:{line:90,column:10}},type:"if",locations:[{start:{line:88,column:10},end:{line:90,column:10}},{start:{line:88,column:10},end:{line:90,column:10}}],line:88},"2":{loc:{start:{line:93,column:9},end:{line:95,column:9}},type:"if",locations:[{start:{line:93,column:9},end:{line:95,column:9}},{start:{line:93,column:9},end:{line:95,column:9}}],line:93},"3":{loc:{start:{line:98,column:10},end:{line:100,column:11}},type:"if",locations:[{start:{line:98,column:10},end:{line:100,column:11}},{start:{line:98,column:10},end:{line:100,column:11}}],line:98}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c734d8a9730aea9b8aaf42fcf2c92f8a84166da9"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_20t5nwprvx=function(){return actualCoverage;};}return actualCoverage;}cov_20t5nwprvx();const authModels=(cov_20t5nwprvx().s[0]++,require('../models/auth'));const helper=(cov_20t5nwprvx().s[1]++,require('../helpers/index'));const jwt=(cov_20t5nwprvx().s[2]++,require('jsonwebtoken'));const{JWT_KEY,JWT_KEY_SECRET,JWT_KEY_CODE}=(cov_20t5nwprvx().s[3]++,require('../config'));const refreshTokens=(cov_20t5nwprvx().s[4]++,[]);cov_20t5nwprvx().s[5]++;module.exports={createUser:async(request,response)=>{cov_20t5nwprvx().f[0]++;cov_20t5nwprvx().s[6]++;try{const salt=(cov_20t5nwprvx().s[7]++,helper.generateSalt(18));const hashPassword=(cov_20t5nwprvx().s[8]++,helper.setPassword(request.body.password,salt));const newDate=(cov_20t5nwprvx().s[9]++,new Date());const data=(cov_20t5nwprvx().s[10]++,{name:request.body.name,username:request.body.username,password:hashPassword.passwordHash,salt:hashPassword.salt,role:request.body.role,created_at:newDate,updated_at:newDate});const result=(cov_20t5nwprvx().s[11]++,await authModels.createUser(data));cov_20t5nwprvx().s[12]++;delete result.password;cov_20t5nwprvx().s[13]++;return helper.response(response,200,result);}catch(error){cov_20t5nwprvx().s[14]++;console.log(error);cov_20t5nwprvx().s[15]++;return helper.response(response,400,error);}},loginUser:async(request,response)=>{cov_20t5nwprvx().f[1]++;cov_20t5nwprvx().s[16]++;try{cov_20t5nwprvx().s[17]++;console.log(request.body.username);cov_20t5nwprvx().s[18]++;console.log(request.body.password);const data=(cov_20t5nwprvx().s[19]++,{username:request.body.username,password:request.body.password});const username=(cov_20t5nwprvx().s[20]++,data.username);const result=(cov_20t5nwprvx().s[21]++,await authModels.checkUsername(username));const hashPassword=(cov_20t5nwprvx().s[22]++,helper.setPassword(data.password,result[0].salt));cov_20t5nwprvx().s[23]++;if(hashPassword.passwordHash===result[0].password){cov_20t5nwprvx().b[0][0]++;const token=(cov_20t5nwprvx().s[24]++,jwt.sign({result,role:result[0].role},process.env.JWT_KEY,{expiresIn:'20m'}));const refreshToken=(cov_20t5nwprvx().s[25]++,jwt.sign({result,role:result[0].role},process.env.JWT_KEY_SECRET));cov_20t5nwprvx().s[26]++;refreshTokens.push(refreshToken);cov_20t5nwprvx().s[27]++;delete result[0].salt;cov_20t5nwprvx().s[28]++;delete result[0].password;cov_20t5nwprvx().s[29]++;delete result[0].created_at;cov_20t5nwprvx().s[30]++;delete result[0].updated_at;cov_20t5nwprvx().s[31]++;result[0].token=token;cov_20t5nwprvx().s[32]++;helper.response(response,200,{...result[0],refreshToken});}else{cov_20t5nwprvx().b[0][1]++;cov_20t5nwprvx().s[33]++;response.json({message:'Password error!'});}}catch(error){cov_20t5nwprvx().s[34]++;// console.log(error)
return helper.response(response,400,'Login failed');}},token:async(request,response)=>{cov_20t5nwprvx().f[2]++;cov_20t5nwprvx().s[35]++;try{const refreshTokenSecret=(cov_20t5nwprvx().s[36]++,process.env.JWT_KEY_SECRET);const api_key=(cov_20t5nwprvx().s[37]++,process.env.JWT_KEY);const{api_token}=(cov_20t5nwprvx().s[38]++,request.body);cov_20t5nwprvx().s[39]++;console.log(api_token);cov_20t5nwprvx().s[40]++;if(!api_token){cov_20t5nwprvx().b[1][0]++;cov_20t5nwprvx().s[41]++;return helper.response(response,400,'unathorization');}else{cov_20t5nwprvx().b[1][1]++;}cov_20t5nwprvx().s[42]++;if(!refreshTokens.includes(api_token)){cov_20t5nwprvx().b[2][0]++;cov_20t5nwprvx().s[43]++;return helper.response(response,403,'Forbidden');}else{cov_20t5nwprvx().b[2][1]++;}cov_20t5nwprvx().s[44]++;jwt.verify(api_token,refreshTokenSecret,(error,result)=>{cov_20t5nwprvx().f[3]++;cov_20t5nwprvx().s[45]++;if(error){cov_20t5nwprvx().b[3][0]++;cov_20t5nwprvx().s[46]++;return response.sendStatus(500);}else{cov_20t5nwprvx().b[3][1]++;}// console.log(result)
const token=(cov_20t5nwprvx().s[47]++,jwt.sign({result,role:result.role},api_key,{expiresIn:'5m'}));// console.log(token)
cov_20t5nwprvx().s[48]++;return helper.response(response,200,{token});});}catch(error){cov_20t5nwprvx().s[49]++;console.log(error);cov_20t5nwprvx().s[50]++;return helper.response(response,400,'Refresh token failed');}},allUser:async function(request,response){cov_20t5nwprvx().f[4]++;cov_20t5nwprvx().s[51]++;try{const result=(cov_20t5nwprvx().s[52]++,await authModels.getUsers());cov_20t5nwprvx().s[53]++;return helper.response(response,200,result);}catch(error){cov_20t5nwprvx().s[54]++;return helper.response(response,500,error);}},deleteUser:async function(request,response){cov_20t5nwprvx().f[5]++;cov_20t5nwprvx().s[55]++;try{const id=(cov_20t5nwprvx().s[56]++,request.params.id);const result=(cov_20t5nwprvx().s[57]++,await authModels.deleteUser(id));cov_20t5nwprvx().s[58]++;return helper.response(response,200,result);}catch(error){cov_20t5nwprvx().s[59]++;return helper.response(response,500,error);}}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiYXV0aE1vZGVscyIsInJlcXVpcmUiLCJoZWxwZXIiLCJqd3QiLCJKV1RfS0VZIiwiSldUX0tFWV9TRUNSRVQiLCJKV1RfS0VZX0NPREUiLCJyZWZyZXNoVG9rZW5zIiwibW9kdWxlIiwiZXhwb3J0cyIsImNyZWF0ZVVzZXIiLCJyZXF1ZXN0IiwicmVzcG9uc2UiLCJzYWx0IiwiZ2VuZXJhdGVTYWx0IiwiaGFzaFBhc3N3b3JkIiwic2V0UGFzc3dvcmQiLCJib2R5IiwicGFzc3dvcmQiLCJuZXdEYXRlIiwiRGF0ZSIsImRhdGEiLCJuYW1lIiwidXNlcm5hbWUiLCJwYXNzd29yZEhhc2giLCJyb2xlIiwiY3JlYXRlZF9hdCIsInVwZGF0ZWRfYXQiLCJyZXN1bHQiLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJsb2dpblVzZXIiLCJjaGVja1VzZXJuYW1lIiwidG9rZW4iLCJzaWduIiwicHJvY2VzcyIsImVudiIsImV4cGlyZXNJbiIsInJlZnJlc2hUb2tlbiIsInB1c2giLCJqc29uIiwibWVzc2FnZSIsInJlZnJlc2hUb2tlblNlY3JldCIsImFwaV9rZXkiLCJhcGlfdG9rZW4iLCJpbmNsdWRlcyIsInZlcmlmeSIsInNlbmRTdGF0dXMiLCJhbGxVc2VyIiwiZ2V0VXNlcnMiLCJkZWxldGVVc2VyIiwiaWQiLCJwYXJhbXMiXSwibWFwcGluZ3MiOiI4aE1BZVk7MkZBZlosS0FBTUEsQ0FBQUEsVUFBVSwwQkFBR0MsT0FBTyxDQUFDLGdCQUFELENBQVYsQ0FBaEIsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMsa0JBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUUsQ0FBQUEsR0FBRywwQkFBR0YsT0FBTyxDQUFDLGNBQUQsQ0FBVixDQUFULENBQ0EsS0FBTSxDQUFFRyxPQUFGLENBQVdDLGNBQVgsQ0FBMkJDLFlBQTNCLDJCQUE0Q0wsT0FBTyxDQUFDLFdBQUQsQ0FBbkQsQ0FBTixDQUdBLEtBQU1NLENBQUFB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MUIsQ0FBK0JpQixLQUEvQixDQUFQLENBQ0gsQ0FHSixDQXJJWSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGF1dGhNb2RlbHMgPSByZXF1aXJlKCcuLi9tb2RlbHMvYXV0aCcpXG5jb25zdCBoZWxwZXIgPSByZXF1aXJlKCcuLi9oZWxwZXJzL2luZGV4JylcbmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpXG5jb25zdCB7IEpXVF9LRVksIEpXVF9LRVlfU0VDUkVULCBKV1RfS0VZX0NPREUgfSA9IHJlcXVpcmUoJy4uL2NvbmZpZycpXG5cblxuY29uc3QgcmVmcmVzaFRva2VucyA9IFtdXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIGNyZWF0ZVVzZXI6IGFzeW5jKHJlcXVlc3QsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzYWx0ID0gaGVscGVyLmdlbmVyYXRlU2FsdCgxOClcbiAgICAgICAgICAgIGNvbnN0IGhhc2hQYXNzd29yZCA9IGhlbHBlci5zZXRQYXNzd29yZChyZXF1ZXN0LmJvZHkucGFzc3dvcmQsIHNhbHQpXG4gICAgICAgICAgICBjb25zdCBuZXdEYXRlID0gbmV3IERhdGUoKVxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiByZXF1ZXN0LmJvZHkubmFtZSxcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogcmVxdWVzdC5ib2R5LnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBoYXNoUGFzc3dvcmQucGFzc3dvcmRIYXNoLFxuICAgICAgICAgICAgICAgIHNhbHQ6IGhhc2hQYXNzd29yZC5zYWx0LFxuICAgICAgICAgICAgICAgIHJvbGU6IHJlcXVlc3QuYm9keS5yb2xlLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ld0RhdGUsXG4gICAgICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3RGF0ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aE1vZGVscy5jcmVhdGVVc2VyKGRhdGEpXG5cbiAgICAgICAgICAgIGRlbGV0ZSByZXN1bHQucGFzc3dvcmRcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgMjAwLCByZXN1bHQpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwMCwgZXJyb3IpXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGxvZ2luVXNlcjogYXN5bmMocmVxdWVzdCwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXF1ZXN0LmJvZHkudXNlcm5hbWUpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKHJlcXVlc3QuYm9keS5wYXNzd29yZCk7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiByZXF1ZXN0LmJvZHkudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHJlcXVlc3QuYm9keS5wYXNzd29yZFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gZGF0YS51c2VybmFtZVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aE1vZGVscy5jaGVja1VzZXJuYW1lKHVzZXJuYW1lKVxuXG4gICAgICAgICAgICAgY29uc3QgaGFzaFBhc3N3b3JkID0gaGVscGVyLnNldFBhc3N3b3JkKGRhdGEucGFzc3dvcmQsIHJlc3VsdFswXS5zYWx0KVxuXG5cbiAgICAgICAgICAgICBpZiAoaGFzaFBhc3N3b3JkLnBhc3N3b3JkSGFzaCA9PT0gcmVzdWx0WzBdLnBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih7cmVzdWx0LCByb2xlOiByZXN1bHRbMF0ucm9sZX0sIHByb2Nlc3MuZW52LkpXVF9LRVksIHtleHBpcmVzSW46ICcyMG0nfSlcbiAgICAgICAgICAgICAgICBjb25zdCByZWZyZXNoVG9rZW4gPSBqd3Quc2lnbih7IHJlc3VsdCwgcm9sZTogcmVzdWx0WzBdLnJvbGV9LCBwcm9jZXNzLmVudi5KV1RfS0VZX1NFQ1JFVCk7XG5cbiAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW5zLnB1c2gocmVmcmVzaFRva2VuKTtcblxuICAgICAgICAgICAgICBkZWxldGUgcmVzdWx0WzBdLnNhbHRcbiAgICAgICAgICAgICAgZGVsZXRlIHJlc3VsdFswXS5wYXNzd29yZFxuICAgICAgICAgICAgICBkZWxldGUgcmVzdWx0WzBdLmNyZWF0ZWRfYXRcbiAgICAgICAgICAgICAgZGVsZXRlIHJlc3VsdFswXS51cGRhdGVkX2F0XG5cbiAgICAgICAgICAgICAgcmVzdWx0WzBdLnRva2VuID0gdG9rZW5cbiAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCAyMDAsIHtcbiAgICAgICAgICAgICAgICAuLi5yZXN1bHRbMF0sXG4gICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuXG4gICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnUGFzc3dvcmQgZXJyb3IhJ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH1cblxuICBcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNDAwLCAnTG9naW4gZmFpbGVkJylcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB0b2tlbjogYXN5bmMocmVxdWVzdCwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgdHJ5IHtcblxuICAgICAgICAgIGNvbnN0IHJlZnJlc2hUb2tlblNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9LRVlfU0VDUkVUXG4gICAgICAgICAgY29uc3QgYXBpX2tleSA9IHByb2Nlc3MuZW52LkpXVF9LRVlcbiAgICAgICAgICBjb25zdCB7IGFwaV90b2tlbiB9ID0gcmVxdWVzdC5ib2R5XG4gICAgICAgICBjb25zb2xlLmxvZyhhcGlfdG9rZW4pXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCFhcGlfdG9rZW4pe1xuICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA0MDAsICd1bmF0aG9yaXphdGlvbicpIFxuICAgICAgICAgfSBcblxuXG4gICAgICAgICBpZiAoIXJlZnJlc2hUb2tlbnMuaW5jbHVkZXMoYXBpX3Rva2VuKSkge1xuICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwMywgJ0ZvcmJpZGRlbicpIFxuICAgICAgICB9XG5cbiAgICAgICAgand0LnZlcmlmeShhcGlfdG9rZW4sIHJlZnJlc2hUb2tlblNlY3JldCwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHQpXG5cbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oeyByZXN1bHQsIHJvbGU6IHJlc3VsdC5yb2xlIH0sIGFwaV9rZXksIHsgZXhwaXJlc0luOiAnNW0nIH0pXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0b2tlbilcbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDIwMCwge1xuICAgICAgICAgICAgICB0b2tlblxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcblxuICAgICAgICB9Y2F0Y2goZXJyb3Ipe1xuICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwMCwgJ1JlZnJlc2ggdG9rZW4gZmFpbGVkJylcbiAgICAgIH1cblxuICAgIH0sXG5cbiAgICAgYWxsVXNlcjogYXN5bmMgZnVuY3Rpb24gKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoTW9kZWxzLmdldFVzZXJzKClcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgMjAwLCByZXN1bHQpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA1MDAsIGVycm9yKVxuXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZGVsZXRlVXNlcjogYXN5bmMgZnVuY3Rpb24gKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG5cbiAgICAgICAgdHJ5IHtcblxuICAgICAgICAgICAgY29uc3QgaWQgPSByZXF1ZXN0LnBhcmFtcy5pZFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aE1vZGVscy5kZWxldGVVc2VyKGlkKVxuXG4gICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCAyMDAsIHJlc3VsdClcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDUwMCwgZXJyb3IpXG4gICAgICAgIH1cblxuXG4gICAgfSxcblxuICAgIFxufSJdfQ==